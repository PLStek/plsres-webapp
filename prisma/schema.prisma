generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Charbon {
    id          Int      @id @default(autoincrement())
    name        String
    description String
    timestamp   DateTime
    replayUrl   String?
    courseId    Int

    resources   Resource[]
    actionneurs CharbonActionneur[]
    course      Course              @relation(fields: [courseId], references: [id], onDelete: Restrict)

    @@index([courseId], name: "courseId")
}

model Course {
    id         Int    @id @default(autoincrement())
    code       String @unique
    name       String

    category CourseCategory
    charbon  Charbon[]
}

enum CourseCategory {
    MATH
    ELEC
    INFO
    MECA
}

model Resource {
    id        Int      @id @default(autoincrement())
    name      String
    url       String
    charbonId Int

    charbon Charbon @relation(fields: [charbonId], references: [id], onDelete: Cascade)
}

model Actionneur {
    id       Int                 @id @default(autoincrement())
    username String              @unique
    isAdmin  Boolean             @default(false)
    isActive Boolean             @default(true)
    charbons CharbonActionneur[]
}

model CharbonActionneur {
    charbon   Charbon @relation(fields: [charbonId], references: [id], onDelete: Cascade)
    charbonId Int

    actionneur   Actionneur @relation(fields: [actionneurId], references: [id], onDelete: Cascade)
    actionneurId Int

    @@id([charbonId, actionneurId])
}
